# Polyglot-RPG: Умный переводчик для ваших TTRPG

**Polyglot-RPG** — это инструмент командной строки (CLI), созданный для полуавтоматического перевода больших текстовых материалов (например, книг правил TTRPG) с использованием больших языковых моделей (LLM).

Главная философия проекта — **"Контроль > Полная Автоматизация"**. Это не волшебная кнопка, а мощный помощник, который автоматизирует рутину (разбор файлов, отправку запросов, сборку текста), но оставляет ключевые решения по качеству (в первую очередь, терминологию) под контролем пользователя.

## Место проекта в общем процессе перевода

`Polyglot-RPG` — это не решение "все-в-одном", а специализированный инструмент для **третьего этапа** в большом процессе перевода. Полный цикл работы над книгой обычно выглядит так:

1.  **Подготовка исходников.** Получение оригинального текста (например, в PDF) и его разделение на логические части (главы).
2.  **Конвертация в Markdown.** Преобразование каждой части в чистый и структурированный `.md` файл. Для этого отлично подходят современные LLM-помощники (Google AI Studio, Claude.ai и др.).
3.  **Перевод с помощью `Polyglot-RPG` (наш этап).**
    *   a) Автоматическое создание глоссария по всем текстам.
    *   b) Ручная проверка и утверждение глоссария.
    *   c) Автоматизированный перевод `.md` файлов с использованием утвержденного глоссария.
4.  **Вычитка и редактура.** Внимательное чтение и стилистическая правка полученного перевода.
5.  **Верстка.** Сборка итоговых глав в финальный формат (например, PDF).

## Ключевые возможности

*   **Проектная структура:** Команда `init` создает стандартизированную и понятную структуру папок для вашего проекта перевода.
*   **Интеллектуальный глоссарий:** Автоматическое извлечение терминов из текста, их фильтрация и даже предварительный перевод с помощью LLM.
*   **Сохранение форматирования:** Благодаря разбору текста в AST, инструмент гарантирует 100% сохранение исходной Markdown-разметки (списки, таблицы, выделение и т.д.).
*   **Поддержка локальных LLM:** Легко настраивается для работы с вашими моделями, запущенными локально через **Ollama** или другие OpenAI-совместимые серверы.
*   **Интерактивность:** Вы можете выбрать, какие именно главы переводить в данный момент.

## Установка

Проект использует стандартные средства Python для управления зависимостями.

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/nrm/polyglot-rpg-cli.git
    cd polyglot-rpg
    ```

2.  **(Рекомендуется)** Создайте и активируйте виртуальное окружение:
    ```bash
    # Используя стандартный venv
    python -m venv .venv
    source .venv/bin/activate  # На Windows: .venv\Scripts\activate

    # Или используя uv (быстрее)
    # uv venv
    # source .venv/bin/activate
    ```

3.  **Установите утилиту и все зависимости:**
    ```bash
    # Установка в редактируемом режиме
    pip install -e .
    ```
    После этого команда `polyglot-rpg` станет доступна в вашем терминале.

## Быстрый старт: Демонстрация на примере

Для демонстрации возможностей инструмента в репозиторий включен **упрощенный пример**, основанный на нескольких страницах из книги правил **Ironsworn**.

**ВАЖНОЕ ПРИМЕЧАНИЕ:** Содержимое примера используется исключительно в демонстрационных целях и не является полным переводом. Автор Ironsworn, Шон Томкин, распространяет оригинальную книгу бесплатно под лицензией `Creative Commons BY-NC-SA 4.0`.

### Как перевести полную книгу Ironsworn самостоятельно?

1.  **Скачайте официальную версию книги** с сайта автора или другого официального источника:
    *   **[Ironsworn Digital Edition на tomkinpress.com](https://tomkinpress.com/products/ironsworn-digital-edition)**
2.  **Самостоятельно преобразуйте** нужные вам главы из PDF в формат `.md`.
3.  **Используйте `polyglot-rpg`** для перевода ваших `.md` файлов, следуя шагам ниже.

### Демонстрационный рабочий процесс

Давайте посмотрим, как использовать инструмент на включенном в репозиторий примере.

### Шаг 1: Инициализация проекта

Сначала создадим структуру папок для нашего перевода.

```bash
polyglot-rpg init example_project/ironsworn
```
Эта команда создаст директории и базовый `01_config.yaml`. Настройте его, указав URL и имя вашей LLM.

### Шаг 2: Подготовка исходников

После конвертации исходной книги в Markdown, мы копируем `.md` файлы в рабочую директорию:
`example_project/ironsworn/02_input_chapters/`

### Шаг 3: Создание глоссария

Запустим извлечение терминов из наших демонстрационных файлов

```bash
polyglot-rpg create-glossary example_project/ironsworn/ --use-llm --pre-translate
```
Процесс займет некоторое время, так как программа будет анализировать все ваши главы. В результате в папке `03_translation_workspace/` появится файл `2_glossary.for_review.yaml`.

**Ваши действия:**
1.  Откройте `2_glossary.for_review.yaml`.
2.  Проверьте и исправьте предложенные переводы.
3.  **Сохраните файл под новым именем `2_glossary.final.yaml` в той же директории.**

### Шаг 4: Перевод глав

Когда финальный глоссарий готов, можно запускать перевод.

```bash
polyglot-rpg translate example_project/ironsworn/
```
Программа найдет ваш глоссарий и предложит выбрать файлы для перевода. Допустим, мы выберем первые три главы, введя `1,2,3`.

После завершения процесса переведенные файлы будут ждать вас в директории:
`example_project/ironsworn/03_translation_workspace/4_final_chapters/`

## Справка по командам

*   `polyglot-rpg init <project_directory>`
    Инициализирует структуру папок для нового проекта.

*   `polyglot-rpg create-glossary <project_directory> [OPTIONS]`
    Анализирует исходные тексты и создает черновик глоссария.
    *   `--use-llm`: Использовать LLM для извлечения и фильтрации терминов (рекомендуется).
    *   `--pre-translate`: (Требует `--use-llm`) Использовать LLM для автоматического предварительного перевода.

*   `polyglot-rpg translate <project_directory>`
    Запускает полный конвейер перевода. Автоматически находит и использует `2_glossary.final.yaml`.

## Конфигурация и LLM

Все настройки находятся в файле `01_config.yaml` вашего проекта. Вы можете легко изменить модель, системные промпты и другие параметры.

Этот инструмент был успешно протестирован с локально запущенным сервером **Ollama** и моделью **gemma3:27b**.

## Лицензия

Проект распространяется под лицензией **MIT**. Подробности в файле `LICENSE`.